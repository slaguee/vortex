<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vortex - Discord Clone Complet</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
/* VARIABLES */
:root {
    --primary: #5865f2;
    --secondary: #eb459e;
    --accent: #57f287;
    --bg-dark: #2b2d31;
    --bg-darker: #1e1f22;
    --bg-light: #313338;
    --bg-lighter: #383a40;
    --text: #f2f3f5;
    --text-muted: #949ba4;
    --success: #23a559;
    --online: #23a559;
    --error: #f23f43;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Open Sans', sans-serif;
    background: var(--bg-darker);
    color: var(--text);
    overflow: hidden;
    height: 100vh;
}

.bg-animation {
    position: fixed;
    inset: 0;
    z-index: 0;
    opacity: 0.05;
    background: radial-gradient(circle at 20% 30%, var(--primary) 0%, transparent 50%);
    animation: pulse 15s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.05; }
    50% { opacity: 0.08; }
}

/* AUTH STYLES */
.auth-container {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    padding: 20px;
}

.auth-box {
    background: var(--bg-dark);
    border-radius: 8px;
    padding: 32px;
    width: 100%;
    max-width: 480px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.24);
}

.logo-large {
    font-size: 32px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-align: center;
    margin-bottom: 8px;
}

.auth-title {
    text-align: center;
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 8px;
}

.auth-subtitle {
    text-align: center;
    color: var(--text-muted);
    font-size: 16px;
    margin-bottom: 20px;
}

.captcha-container {
    margin-bottom: 20px;
}

.captcha-box {
    background: var(--bg-lighter);
    border: 2px solid var(--bg-light);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 16px;
}

.captcha-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 12px;
    text-align: center;
}

.captcha-question {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 16px;
    text-align: center;
    color: var(--primary);
}

.captcha-input {
    width: 100%;
    padding: 12px;
    background: var(--bg-dark);
    border: 2px solid var(--bg-light);
    border-radius: 4px;
    color: var(--text);
    font-size: 18px;
    text-align: center;
    font-weight: 600;
}

.captcha-input:focus {
    outline: none;
    border-color: var(--primary);
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.form-input {
    width: 100%;
    padding: 10px;
    background: var(--bg-darker);
    border: 1px solid var(--bg-lighter);
    border-radius: 3px;
    color: var(--text);
    font-size: 16px;
    font-family: 'Open Sans', sans-serif;
    transition: border-color 0.2s;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary);
}

.form-hint {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 6px;
}

.form-error {
    color: var(--error);
    font-size: 13px;
    margin-top: 6px;
    display: none;
}

.form-error.active {
    display: block;
}

.form-success {
    color: var(--success);
    font-size: 13px;
    margin-top: 6px;
    display: none;
    padding: 10px;
    background: rgba(35, 165, 89, 0.1);
    border-radius: 3px;
}

.form-success.active {
    display: block;
}

.auth-button {
    width: 100%;
    padding: 12px;
    background: var(--primary);
    border: none;
    border-radius: 3px;
    color: white;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}

.auth-button:hover {
    background: #4752c4;
}

.auth-link {
    margin-top: 12px;
    font-size: 14px;
    color: var(--text-muted);
}

.auth-link a {
    color: var(--primary);
    text-decoration: none;
}

/* APP LAYOUT */
.app-container {
    position: relative;
    z-index: 1;
    display: none;
    height: 100vh;
}

.app-container.active {
    display: flex;
}

.server-sidebar {
    width: 72px;
    background: var(--bg-darker);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    gap: 8px;
    overflow-y: auto;
}

.server-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--bg-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.server-icon:hover,
.server-icon.active {
    border-radius: 16px;
    background: var(--primary);
}

.server-icon span {
    font-size: 20px;
}

.separator {
    width: 32px;
    height: 2px;
    background: var(--bg-lighter);
    margin: 4px 0;
}

.channel-sidebar {
    width: 240px;
    background: var(--bg-dark);
    display: flex;
    flex-direction: column;
}

.sidebar-header {
    height: 48px;
    padding: 0 16px;
    border-bottom: 1px solid var(--bg-darker);
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    box-shadow: 0 1px 0 rgba(0,0,0,0.2);
}

.sidebar-header:hover {
    background: var(--bg-lighter);
}

.sidebar-title {
    font-size: 16px;
    font-weight: 600;
}

.dropdown-btn {
    background: transparent;
    border: none;
    color: var(--text);
    cursor: pointer;
    font-size: 12px;
    padding: 4px;
}

.dropdown-icon {
    transition: transform 0.2s;
}

.dropdown-icon.active {
    transform: rotate(180deg);
}

.server-menu {
    position: absolute;
    top: 48px;
    left: 0;
    right: 0;
    background: var(--bg-darker);
    border-radius: 4px;
    margin: 4px;
    padding: 6px;
    z-index: 100;
    display: none;
    box-shadow: 0 8px 16px rgba(0,0,0,0.24);
}

.server-menu.active {
    display: block;
}

.server-menu-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    border-radius: 2px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
}

.server-menu-item:hover {
    background: var(--primary);
}

.server-menu-item.danger {
    color: var(--error);
}

.server-menu-item.danger:hover {
    background: var(--error);
    color: white;
}

.menu-separator {
    height: 1px;
    background: var(--bg-lighter);
    margin: 4px 0;
}

.search-bar {
    padding: 8px;
    background: var(--bg-darker);
}

.search-input {
    width: 100%;
    padding: 6px 8px;
    background: var(--bg-darker);
    border: none;
    border-radius: 4px;
    color: var(--text);
    font-size: 14px;
}

.channels {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
}

.section-header {
    padding: 16px 8px 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
}

.channel-category {
    padding: 16px 8px 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
}

.add-channel-btn {
    opacity: 0;
    transition: opacity 0.2s;
    font-size: 16px;
}

.channel-category:hover .add-channel-btn {
    opacity: 1;
}

.channel-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    border-radius: 4px;
    cursor: pointer;
    margin: 1px 0;
    color: var(--text-muted);
    transition: all 0.2s;
}

.channel-item:hover,
.channel-item.active {
    background: var(--bg-lighter);
    color: var(--text);
}

.channel-icon {
    font-size: 18px;
}

.channel-label {
    flex: 1;
    font-size: 15px;
    font-weight: 500;
}

.voice-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--success);
    display: none;
    animation: voicePulse 2s infinite;
}

.voice-indicator.active {
    display: block;
}

@keyframes voicePulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.dm-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    margin: 2px 0;
    transition: background 0.2s;
}

.dm-item:hover,
.dm-item.active {
    background: var(--bg-lighter);
}

.dm-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 14px;
    position: relative;
}

.dm-avatar::after {
    content: '';
    position: absolute;
    bottom: -2px;
    right: -2px;
    width: 10px;
    height: 10px;
    background: var(--online);
    border: 2px solid var(--bg-dark);
    border-radius: 50%;
}

.dm-info {
    flex: 1;
    min-width: 0;
}

.dm-name {
    font-size: 15px;
    font-weight: 500;
    overflow: hidden;
    text-overflow: ellipsis;
}

.dm-status {
    font-size: 12px;
    color: var(--text-muted);
}

.voice-panel {
    background: var(--bg-darker);
    border-top: 1px solid var(--bg-light);
    padding: 8px;
    display: none;
}

.voice-panel.active {
    display: block;
}

.voice-info {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}

.voice-icon {
    font-size: 16px;
}

.voice-channel-info {
    flex: 1;
}

.voice-channel-name {
    font-size: 14px;
    font-weight: 600;
}

.voice-status {
    font-size: 12px;
    color: var(--text-muted);
}

.voice-disconnect {
    background: transparent;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 18px;
    padding: 4px;
}

.voice-disconnect:hover {
    color: var(--text);
}

.voice-controls {
    display: flex;
    gap: 4px;
}

.voice-btn {
    flex: 1;
    padding: 8px;
    background: var(--bg-light);
    border: none;
    border-radius: 4px;
    color: var(--text);
    cursor: pointer;
    font-size: 18px;
    transition: all 0.2s;
}

.voice-btn:hover {
    background: var(--bg-lighter);
}

.voice-btn.active {
    background: var(--success);
}

.voice-btn.muted {
    background: var(--error);
}

.user-area {
    padding: 8px;
    background: var(--bg-darker);
    display: flex;
    align-items: center;
    gap: 8px;
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 14px;
    position: relative;
    cursor: pointer;
}

.user-avatar::after {
    content: '';
    position: absolute;
    bottom: -2px;
    right: -2px;
    width: 10px;
    height: 10px;
    background: var(--online);
    border: 2px solid var(--bg-darker);
    border-radius: 50%;
}

.user-info {
    flex: 1;
    min-width: 0;
}

.user-name {
    font-size: 14px;
    font-weight: 600;
    overflow: hidden;
    text-overflow: ellipsis;
}

.user-tag {
    font-size: 12px;
    color: var(--text-muted);
}

.user-controls {
    display: flex;
    gap: 4px;
}

.user-control-btn {
    width: 32px;
    height: 32px;
    border-radius: 4px;
    background: transparent;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 18px;
    transition: all 0.2s;
}

.user-control-btn:hover {
    background: var(--bg-lighter);
    color: var(--text);
}

.user-control-btn.active {
    color: var(--success);
}

.user-control-btn.muted {
    color: var(--error);
}

.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--bg-dark);
}

.chat-header {
    height: 48px;
    padding: 0 16px;
    border-bottom: 1px solid var(--bg-darker);
    display: none;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 1px 0 rgba(0,0,0,0.2);
}

.chat-header.active {
    display: flex;
}

.chat-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.chat-icon {
    font-size: 24px;
    color: var(--text-muted);
}

.chat-name {
    font-size: 16px;
    font-weight: 600;
}

.chat-description {
    font-size: 13px;
    color: var(--text-muted);
    margin-left: 8px;
    padding-left: 8px;
    border-left: 1px solid var(--text-muted);
}

.chat-actions {
    display: flex;
    gap: 12px;
}

.chat-action-btn {
    width: 24px;
    height: 24px;
    background: transparent;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 20px;
    transition: color 0.2s;
}

.chat-action-btn:hover {
    color: var(--text);
}

.messages-area {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

.welcome-screen {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    text-align: center;
}

.welcome-icon {
    font-size: 80px;
    margin-bottom: 24px;
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.welcome-title {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 8px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.welcome-subtitle {
    font-size: 20px;
    margin-bottom: 12px;
}

.welcome-text {
    color: var(--text-muted);
    font-size: 16px;
    max-width: 500px;
    margin-bottom: 24px;
}

.welcome-actions {
    display: flex;
    gap: 12px;
}

.welcome-btn {
    padding: 12px 24px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
}

.welcome-btn.primary {
    background: var(--primary);
    color: white;
}

.welcome-btn.primary:hover {
    background: #4752c4;
}

.welcome-btn.secondary {
    background: var(--bg-lighter);
    color: var(--text);
}

.welcome-btn.secondary:hover {
    background: var(--bg-light);
}

.messages-container {
    padding: 16px;
    display: none;
    flex-direction: column;
}

.messages-container.active {
    display: flex;
}

.message-group {
    display: flex;
    gap: 16px;
    padding: 4px 0;
    margin-bottom: 16px;
}

.message-group:hover {
    background: rgba(0,0,0,0.04);
}

.message-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
}

.message-content {
    flex: 1;
}

.message-header {
    display: flex;
    align-items: baseline;
    gap: 8px;
    margin-bottom: 2px;
}

.message-author {
    font-weight: 500;
    font-size: 16px;
    cursor: pointer;
}

.message-author:hover {
    text-decoration: underline;
}

.message-timestamp {
    font-size: 12px;
    color: var(--text-muted);
}

.message-text {
    font-size: 16px;
    line-height: 1.375;
    word-wrap: break-word;
}

.message-input-area {
    padding: 16px;
    display: none;
}

.message-input-area.active {
    display: block;
}

.message-input-wrapper {
    background: var(--bg-lighter);
    border-radius: 8px;
    padding: 11px 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.message-input {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--text);
    font-size: 15px;
    font-family: 'Open Sans', sans-serif;
}

.message-input:focus {
    outline: none;
}

.input-btn {
    background: transparent;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 20px;
    padding: 4px;
    transition: color 0.2s;
}

.input-btn:hover {
    color: var(--text);
}

.members-sidebar {
    width: 240px;
    background: var(--bg-dark);
    display: none;
    flex-direction: column;
    border-left: 1px solid var(--bg-darker);
}

.members-sidebar.active {
    display: flex;
}

.members-header {
    padding: 24px 16px 8px;
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    gap: 8px;
}

.members-count {
    color: var(--text-muted);
}

.members-list {
    flex: 1;
    overflow-y: auto;
    padding: 0 8px;
}

.member-category {
    padding: 16px 8px 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
}

.member-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 6px 8px;
    border-radius: 4px;
    cursor: pointer;
    margin: 1px 0;
}

.member-item:hover {
    background: var(--bg-lighter);
}

.member-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 14px;
    position: relative;
}

.member-avatar::after {
    content: '';
    position: absolute;
    bottom: -2px;
    right: -2px;
    width: 10px;
    height: 10px;
    background: var(--online);
    border: 2px solid var(--bg-dark);
    border-radius: 50%;
}

.member-name {
    font-size: 15px;
    font-weight: 500;
}

/* MODALS */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: none;
    z-index: 1000;
}

.modal.active {
    display: flex;
}

.modal-sidebar {
    width: 220px;
    background: var(--bg-dark);
    padding: 60px 8px 60px 20px;
}

.modal-nav-item {
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    color: var(--text-muted);
    margin-bottom: 2px;
    transition: all 0.2s;
}

.modal-nav-item:hover {
    background: var(--bg-lighter);
    color: var(--text);
}

.modal-nav-item.active {
    background: var(--bg-lighter);
    color: var(--text);
}

.modal-nav-item.danger {
    color: var(--error);
    margin-top: 12px;
}

.modal-nav-separator {
    height: 1px;
    background: var(--bg-lighter);
    margin: 8px 0;
}

.modal-content-area {
    flex: 1;
    background: var(--bg-dark);
    padding: 60px 40px;
    overflow-y: auto;
    position: relative;
}

.modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: transparent;
    border: 2px solid var(--text-muted);
    color: var(--text-muted);
    font-size: 20px;
    cursor: pointer;
    transition: all 0.2s;
}

.modal-close:hover {
    border-color: var(--text);
    color: var(--text);
}

.settings-tab {
    display: none;
}

.settings-tab.active {
    display: block;
}

.settings-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 20px;
}

.settings-section {
    margin-bottom: 24px;
}

.settings-card {
    background: var(--bg-lighter);
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 12px;
}

.settings-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.settings-info {
    flex: 1;
}

.settings-label {
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 4px;
}

.settings-value {
    font-size: 16px;
}

.edit-btn {
    padding: 8px 16px;
    background: var(--primary);
    border: none;
    border-radius: 3px;
    color: white;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}

.edit-btn:hover {
    background: #4752c4;
}

.profile-preview {
    position: relative;
    background: var(--bg-lighter);
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 20px;
}

.profile-banner {
    height: 100px;
    background: var(--primary);
}

.profile-avatar-container {
    position: absolute;
    top: 60px;
    left: 16px;
}

.profile-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: 700;
    border: 6px solid var(--bg-lighter);
}

.profile-info {
    padding: 60px 16px 16px;
}

.profile-username {
    font-size: 20px;
    font-weight: 700;
}

.profile-tag {
    font-size: 16px;
    color: var(--text-muted);
}

.color-picker {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 12px;
}

.color-option {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.2s;
}

.color-option:hover {
    transform: scale(1.1);
}

.color-option.selected {
    border-color: white;
}

.settings-select {
    width: 100%;
    padding: 10px;
    background: var(--bg-dark);
    border: 1px solid var(--bg-light);
    border-radius: 3px;
    color: var(--text);
    font-size: 16px;
    margin-top: 8px;
}

.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1001;
}

.modal-overlay.active {
    display: flex;
}

.modal-dialog {
    background: var(--bg-dark);
    border-radius: 4px;
    padding: 16px;
    max-width: 440px;
    width: 90%;
}

.modal-dialog.large {
    max-width: 600px;
}

.modal-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 8px;
}

.modal-text {
    color: var(--text-muted);
    margin-bottom: 20px;
}

.modal-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    margin-top: 16px;
}

.modal-btn {
    padding: 10px 16px;
    border-radius: 3px;
    border: none;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
}

.modal-btn.primary {
    background: var(--primary);
    color: white;
}

.modal-btn.primary:hover {
    background: #4752c4;
}

.modal-btn.secondary {
    background: transparent;
    color: var(--text);
}

.modal-btn.secondary:hover {
    background: var(--bg-lighter);
}

.channel-type-selector {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
}

.channel-type-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--bg-lighter);
    border: 2px solid transparent;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.channel-type-option:hover,
.channel-type-option.active {
    border-color: var(--primary);
}

.channel-type-icon {
    font-size: 24px;
}

.channel-type-title {
    font-weight: 600;
    margin-bottom: 4px;
}

.channel-type-desc {
    font-size: 14px;
    color: var(--text-muted);
}

.invite-code-container {
    display: flex;
    gap: 8px;
    margin: 16px 0;
}

.invite-code-input {
    flex: 1;
    padding: 12px;
    background: var(--bg-lighter);
    border: 2px solid var(--primary);
    border-radius: 4px;
    color: var(--text);
    font-size: 18px;
    font-weight: 700;
    font-family: monospace;
    text-align: center;
    letter-spacing: 2px;
}

.copy-btn {
    padding: 12px 24px;
    background: var(--primary);
    border: none;
    border-radius: 4px;
    color: white;
    font-weight: 500;
    cursor: pointer;
}

.copy-btn:hover {
    background: #4752c4;
}

::-webkit-scrollbar {
    width: 16px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: var(--bg-darker);
    border: 4px solid transparent;
    background-clip: padding-box;
    border-radius: 8px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--bg-lighter);
    border: 4px solid transparent;
    background-clip: padding-box;
}

.hidden {
    display: none !important;
}
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <!-- ===================== AUTH CONTAINER ===================== -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="logo-large">VORTEX</div>
            <h2 class="auth-title" id="authTitle">Cr√©er un compte</h2>
            <p class="auth-subtitle" id="authSubtitle">Rejoignez la communaut√© !</p>
            
            <!-- Captcha Anti-Bot -->
            <div class="captcha-container" id="captchaContainer">
                <div class="captcha-box">
                    <div class="captcha-title">ü§ñ V√©rification Anti-Bot</div>
                    <div class="captcha-question" id="captchaQuestion">Combien font 5 + 3 ?</div>
                    <input type="text" class="captcha-input" id="captchaInput" placeholder="Votre r√©ponse">
                    <div class="form-error" id="captchaError">R√©ponse incorrecte !</div>
                </div>
                <button class="auth-button" id="verifyCaptchaBtn">V√©rifier</button>
            </div>
            
            <!-- Auth Form -->
            <form id="authForm" class="hidden">
                <div class="form-group">
                    <label class="form-label">Pseudo <span style="color: #f23f43;">*</span></label>
                    <input type="text" class="form-input" id="usernameInput" placeholder="ChoisisUnPseudo123" maxlength="32">
                    <div class="form-hint">Ton pseudo sera visible par tous. Tu pourras le changer plus tard.</div>
                    <div class="form-error" id="usernameError">Ce pseudo est d√©j√† pris</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email <span style="color: #f23f43;">*</span></label>
                    <input type="email" class="form-input" id="emailInput" placeholder="exemple@email.com">
                    <div class="form-error" id="emailError">Cette adresse email est invalide</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Mot de passe <span style="color: #f23f43;">*</span></label>
                    <input type="password" class="form-input" id="passwordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
                    <div class="form-hint">Au moins 6 caract√®res</div>
                    <div class="form-error" id="passwordError">Le mot de passe doit contenir au moins 6 caract√®res</div>
                </div>
                
                <button type="submit" class="auth-button" id="authButton">Continuer</button>
                
                <div class="auth-link">
                    <span id="authSwitchText">Tu as d√©j√† un compte ?</span>
                    <a href="#" id="authSwitch">Se connecter</a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ===================== MAIN APP ===================== -->
    <div class="app-container" id="appContainer">
        
        <!-- Server Sidebar -->
        <div class="server-sidebar">
            <div class="server-icon home active" id="dmButton" title="Messages priv√©s">
                <span>‚ö°</span>
            </div>
            <div class="separator"></div>
            <div id="serverList"></div>
            <div class="server-icon add-server" id="addServerBtn" title="Ajouter un serveur">
                <span>+</span>
            </div>
        </div>

        <!-- Channel Sidebar -->
        <div class="channel-sidebar">
            <div class="sidebar-header" id="sidebarHeader">
                <span class="sidebar-title" id="sidebarTitle">Amis</span>
                <button class="dropdown-btn" id="dropdownBtn">
                    <span class="dropdown-icon">‚ñº</span>
                </button>
            </div>
            
            <!-- Server Menu Dropdown -->
            <div class="server-menu" id="serverMenu">
                <div class="server-menu-item" id="inviteBtn">
                    <span>üë•</span>
                    <span>Inviter des gens</span>
                </div>
                <div class="server-menu-item" id="serverSettingsBtn">
                    <span>‚öôÔ∏è</span>
                    <span>Param√®tres du serveur</span>
                </div>
                <div class="server-menu-item" id="createChannelBtn">
                    <span>‚ûï</span>
                    <span>Cr√©er un salon</span>
                </div>
                <div class="menu-separator"></div>
                <div class="server-menu-item danger" id="leaveServerBtn">
                    <span>üö™</span>
                    <span>Quitter le serveur</span>
                </div>
            </div>
            
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="Rechercher" id="searchInput">
            </div>
            
            <div class="channels" id="channelsList">
                <div class="dm-section">
                    <div class="section-header">
                        <span>MESSAGES PRIV√âS</span>
                    </div>
                </div>
            </div>
            
            <!-- Voice Panel (when in voice channel) -->
            <div class="voice-panel" id="voicePanel">
                <div class="voice-info">
                    <span class="voice-icon">üîä</span>
                    <div class="voice-channel-info">
                        <div class="voice-channel-name" id="voiceChannelName">Salon Vocal</div>
                        <div class="voice-status">Connect√©</div>
                    </div>
                    <button class="voice-disconnect" id="voiceDisconnect" title="D√©connecter">‚úï</button>
                </div>
                <div class="voice-controls">
                    <button class="voice-btn" id="micToggle" title="Micro">
                        <span class="voice-icon">üé§</span>
                    </button>
                    <button class="voice-btn" id="audioToggle" title="Audio">
                        <span class="voice-icon">üéß</span>
                    </button>
                    <button class="voice-btn" id="settingsVoiceBtn" title="Param√®tres audio">
                        <span class="voice-icon">‚öôÔ∏è</span>
                    </button>
                </div>
            </div>
            
            <div class="user-area">
                <div class="user-avatar" id="userAvatar" title="Profil"></div>
                <div class="user-info">
                    <div class="user-name" id="userName"></div>
                    <div class="user-tag" id="userTag">#0000</div>
                </div>
                <div class="user-controls">
                    <button class="user-control-btn" id="userMicBtn" title="Couper le micro">
                        <span>üé§</span>
                    </button>
                    <button class="user-control-btn" id="userAudioBtn" title="Rendre sourd">
                        <span>üéß</span>
                    </button>
                    <button class="user-control-btn" id="userSettingsBtn" title="Param√®tres utilisateur">
                        <span>‚öôÔ∏è</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Chat Header -->
            <div class="chat-header" id="chatHeader">
                <div class="chat-info">
                    <span class="chat-icon" id="chatIcon">#</span>
                    <span class="chat-name" id="chatName">g√©n√©ral</span>
                    <span class="chat-description" id="chatDescription">Bienvenue !</span>
                </div>
                <div class="chat-actions">
                    <button class="chat-action-btn" title="Appel vocal" id="startCallBtn">üìû</button>
                    <button class="chat-action-btn" title="Appel vid√©o">üìπ</button>
                    <button class="chat-action-btn" title="√âpingler">üìå</button>
                    <button class="chat-action-btn" title="Rechercher">üîç</button>
                    <button class="chat-action-btn" title="Membres" id="toggleMembersBtn">üë•</button>
                </div>
            </div>

            <!-- Messages Area -->
            <div class="messages-area" id="messagesArea">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">üöÄ</div>
                    <h1 class="welcome-title">Bienvenue sur VORTEX</h1>
                    <h2 class="welcome-subtitle" id="welcomeUsername"></h2>
                    <p class="welcome-text">
                        Ton aventure commence ici ! Ajoute des amis, cr√©e des serveurs et commence √† discuter.
                    </p>
                    <div class="welcome-actions">
                        <button class="welcome-btn primary" id="addFriendWelcomeBtn">
                            üë• Ajouter un ami
                        </button>
                        <button class="welcome-btn secondary" id="createServerWelcomeBtn">
                            ‚ú® Cr√©er un serveur
                        </button>
                    </div>
                </div>

                <!-- Messages Container -->
                <div class="messages-container" id="messagesContainer"></div>
            </div>

            <!-- Message Input -->
            <div class="message-input-area" id="messageInputArea">
                <div class="message-input-wrapper">
                    <button class="input-btn" id="attachBtn" title="Joindre un fichier">üìé</button>
                    <input type="text" class="message-input" id="messageInput" placeholder="Envoyer un message...">
                    <button class="input-btn" id="emojiBtn" title="Emoji">üòä</button>
                </div>
            </div>
        </div>

        <!-- Members Sidebar -->
        <div class="members-sidebar" id="membersSidebar">
            <div class="members-header">
                <span>MEMBRES</span>
                <span class="members-count" id="membersCount">0</span>
            </div>
            <div class="members-list" id="membersList"></div>
        </div>
    </div>
    
    <!-- ===================== MODALS ===================== -->
    
    <!-- User Settings Modal -->
    <div class="modal" id="userSettingsModal">
        <div class="modal-sidebar">
            <div class="modal-nav-item active" data-tab="account">Mon compte</div>
            <div class="modal-nav-item" data-tab="profile">Profil</div>
            <div class="modal-nav-item" data-tab="privacy">Confidentialit√©</div>
            <div class="modal-nav-separator"></div>
            <div class="modal-nav-item danger" id="logoutBtn">D√©connexion</div>
        </div>
        <div class="modal-content-area">
            <button class="modal-close" id="closeUserSettings">‚úï</button>
            
            <!-- Account Tab -->
            <div class="settings-tab active" id="accountTab">
                <h2 class="settings-title">Mon compte</h2>
                
                <div class="settings-section">
                    <div class="settings-card">
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">PSEUDO</div>
                                <div class="settings-value" id="displayUsername"></div>
                            </div>
                            <button class="edit-btn" id="editUsernameBtn">Modifier</button>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">EMAIL</div>
                                <div class="settings-value" id="displayEmail"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">MOT DE PASSE</div>
                                <div class="settings-value">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                            </div>
                            <button class="edit-btn" id="editPasswordBtn">Modifier</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Profile Tab -->
            <div class="settings-tab" id="profileTab">
                <h2 class="settings-title">Profil utilisateur</h2>
                
                <div class="settings-section">
                    <div class="profile-preview">
                        <div class="profile-banner" id="profileBanner"></div>
                        <div class="profile-avatar-container">
                            <div class="profile-avatar" id="profileAvatar"></div>
                        </div>
                        <div class="profile-info">
                            <div class="profile-username" id="profileUsername"></div>
                            <div class="profile-tag" id="profileTag"></div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-label">COULEUR DE L'AVATAR</div>
                        <div class="color-picker" id="avatarColorPicker">
                            <div class="color-option" data-color="#5865f2" style="background: #5865f2;"></div>
                            <div class="color-option" data-color="#eb459e" style="background: #eb459e;"></div>
                            <div class="color-option" data-color="#57f287" style="background: #57f287;"></div>
                            <div class="color-option" data-color="#fee75c" style="background: #fee75c;"></div>
                            <div class="color-option" data-color="#ed4245" style="background: #ed4245;"></div>
                            <div class="color-option" data-color="#eb459e" style="background: #eb459e;"></div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-label">BANNI√àRE</div>
                        <div class="color-picker" id="bannerColorPicker">
                            <div class="color-option" data-color="#5865f2" style="background: #5865f2;"></div>
                            <div class="color-option" data-color="#3ba55d" style="background: #3ba55d;"></div>
                            <div class="color-option" data-color="#faa61a" style="background: #faa61a;"></div>
                            <div class="color-option" data-color="#ed4245" style="background: #ed4245;"></div>
                            <div class="color-option" data-color="#9b59b6" style="background: #9b59b6;"></div>
                            <div class="color-option" data-color="#1abc9c" style="background: #1abc9c;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Privacy Tab -->
            <div class="settings-tab" id="privacyTab">
                <h2 class="settings-title">Confidentialit√© et s√©curit√©</h2>
                <div class="settings-section">
                    <div class="settings-card">
                        <div class="settings-label">Qui peut t'ajouter en ami ?</div>
                        <select class="settings-select">
                            <option>Tout le monde</option>
                            <option>Amis d'amis</option>
                            <option>Membres du serveur</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Username Modal -->
    <div class="modal-overlay" id="editUsernameModal">
        <div class="modal-dialog">
            <h3 class="modal-title">Modifier ton pseudo</h3>
            <div class="modal-text">Entre ton mot de passe actuel pour confirmer</div>
            <form id="editUsernameForm">
                <div class="form-group">
                    <label class="form-label">NOUVEAU PSEUDO</label>
                    <input type="text" class="form-input" id="newUsernameInput" maxlength="32">
                </div>
                <div class="form-group">
                    <label class="form-label">MOT DE PASSE ACTUEL</label>
                    <input type="password" class="form-input" id="confirmPasswordUsername">
                    <div class="form-error" id="usernamePasswordError">Mot de passe incorrect</div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" id="cancelEditUsername">Annuler</button>
                    <button type="submit" class="modal-btn primary">Confirmer</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Password Modal -->
    <div class="modal-overlay" id="editPasswordModal">
        <div class="modal-dialog">
            <h3 class="modal-title">Modifier ton mot de passe</h3>
            <form id="editPasswordForm">
                <div class="form-group">
                    <label class="form-label">MOT DE PASSE ACTUEL</label>
                    <input type="password" class="form-input" id="currentPasswordInput">
                    <div class="form-error" id="currentPasswordError">Mot de passe incorrect</div>
                </div>
                <div class="form-group">
                    <label class="form-label">NOUVEAU MOT DE PASSE</label>
                    <input type="password" class="form-input" id="newPasswordInput" minlength="6">
                </div>
                <div class="form-group">
                    <label class="form-label">CONFIRMER LE NOUVEAU MOT DE PASSE</label>
                    <input type="password" class="form-input" id="confirmPasswordInput">
                    <div class="form-error" id="confirmPasswordError">Les mots de passe ne correspondent pas</div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" id="cancelEditPassword">Annuler</button>
                    <button type="submit" class="modal-btn primary">Confirmer</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Friend Modal -->
    <div class="modal-overlay" id="addFriendModal">
        <div class="modal-dialog">
            <h3 class="modal-title">Ajouter un ami</h3>
            <div class="modal-text">Tu peux ajouter des amis avec leur <strong>pseudo</strong></div>
            <form id="addFriendForm">
                <div class="form-group">
                    <label class="form-label">PSEUDO DE TON AMI</label>
                    <input type="text" class="form-input" id="friendUsernameInput" placeholder="Pseudo123">
                    <div class="form-error" id="friendError">Aucun utilisateur trouv√©</div>
                    <div class="form-success" id="friendSuccess">‚úì Ami ajout√© !</div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" id="cancelAddFriend">Annuler</button>
                    <button type="submit" class="modal-btn primary">Envoyer la demande</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Create Server Modal -->
    <div class="modal-overlay" id="createServerModal">
        <div class="modal-dialog">
            <h3 class="modal-title">Personnalise ton serveur</h3>
            <div class="modal-text">Donne une personnalit√© √† ton serveur avec un nom et une ic√¥ne</div>
            <form id="createServerForm">
                <div class="form-group">
                    <label class="form-label">NOM DU SERVEUR</label>
                    <input type="text" class="form-input" id="serverNameInput" placeholder="Mon serveur">
                </div>
                <div class="form-group">
                    <label class="form-label">IC√îNE DU SERVEUR</label>
                    <input type="text" class="form-input" id="serverIconInput" placeholder="üéÆ" maxlength="2">
                    <div class="form-hint">Utilise un emoji</div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" id="cancelCreateServer">Retour</button>
                    <button type="submit" class="modal-btn primary">Cr√©er</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Create Channel Modal -->
    <div class="modal-overlay" id="createChannelModal">
        <div class="modal-dialog">
            <h3 class="modal-title">Cr√©er un salon</h3>
            <form id="createChannelForm">
                <div class="form-group">
                    <label class="form-label">TYPE DE SALON</label>
                    <div class="channel-type-selector">
                        <div class="channel-type-option active" data-type="text">
                            <span class="channel-type-icon">#</span>
                            <div>
                                <div class="channel-type-title">Salon textuel</div>
                                <div class="channel-type-desc">Envoie des messages, images, GIFs</div>
                            </div>
                        </div>
                        <div class="channel-type-option" data-type="voice">
                            <span class="channel-type-icon">üîä</span>
                            <div>
                                <div class="channel-type-title">Salon vocal</div>
                                <div class="channel-type-desc">Discute avec la voix, vid√©o et partage d'√©cran</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">NOM DU SALON</label>
                    <input type="text" class="form-input" id="channelNameInput" placeholder="nouveau-salon">
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" id="cancelCreateChannel">Annuler</button>
                    <button type="submit" class="modal-btn primary">Cr√©er le salon</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Server Settings Modal -->
    <div class="modal-overlay" id="serverSettingsModal">
        <div class="modal-dialog large">
            <h3 class="modal-title">Param√®tres du serveur</h3>
            <form id="serverSettingsForm">
                <div class="form-group">
                    <label class="form-label">NOM DU SERVEUR</label>
                    <input type="text" class="form-input" id="editServerNameInput">
                </div>
                <div class="form-group">
                    <label class="form-label">IC√îNE DU SERVEUR</label>
                    <input type="text" class="form-input" id="editServerIconInput" maxlength="2">
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" id="cancelServerSettings">Annuler</button>
                    <button type="submit" class="modal-btn primary">Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Invite Modal -->
    <div class="modal-overlay" id="inviteModal">
        <div class="modal-dialog">
            <h3 class="modal-title">Inviter des amis</h3>
            <div class="modal-text">Partage ce code avec tes amis pour qu'ils rejoignent ton serveur</div>
            <div class="invite-code-container">
                <input type="text" class="invite-code-input" id="inviteCodeDisplay" readonly>
                <button class="copy-btn" id="copyInviteBtn">Copier</button>
            </div>
            <div class="modal-actions">
                <button type="button" class="modal-btn primary" id="closeInviteModal">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Join Server Modal -->
    <div class="modal-overlay" id="joinServerModal">
        <div class="modal-dialog">
            <h3 class="modal-title">Rejoindre un serveur</h3>
            <div class="modal-text">Entre le code d'invitation pour rejoindre un serveur</div>
            <form id="joinServerForm">
                <div class="form-group">
                    <label class="form-label">CODE D'INVITATION</label>
                    <input type="text" class="form-input" id="joinCodeInput" placeholder="ABCD1234">
                    <div class="form-error" id="joinCodeError">Code invalide</div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" id="cancelJoinServer">Annuler</button>
                    <button type="submit" class="modal-btn primary">Rejoindre</button>
                </div>
            </form>
        </div>
    </div>

    <script src="vortex-app-1.js"></script>
    <script src="vortex-app-2.js"></script>
    <script src="vortex-app-3.js"></script>
    <script>
// ============================================
// VORTEX - JAVASCRIPT PARTIE 1
// Auth, Data Manager, Captcha, Vortex Bot
// ============================================

// ============================================
// APP STATE
// ============================================
const AppState = {
    currentUser: null,
    currentView: 'home', // 'home', 'dm', 'server', 'channel'
    currentDM: null,
    currentServer: null,
    currentChannel: null,
    isLoginMode: false,
    captchaAnswer: 0,
    captchaQuestion: '',
    friends: [],
    servers: {},
    voiceState: {
        connected: false,
        channelId: null,
        channelName: '',
        micMuted: false,
        audioMuted: false
    },
    callState: {
        active: false,
        type: null, // 'voice' or 'video'
        with: null
    },
    membersSidebarOpen: false,
    avatarColor: '#5865f2',
    bannerColor: '#5865f2'
};

// ============================================
// DATA MANAGER
// ============================================
class DataManager {
    static save(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    static get(key) {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : null;
    }

    static getAllUsers() {
        return this.get('vortexUsers') || {};
    }

    static saveUser(username, userData) {
        const users = this.getAllUsers();
        users[username] = userData;
        this.save('vortexUsers', users);
    }

    static getUserByUsername(username) {
        const users = this.getAllUsers();
        return users[username] || null;
    }

    static getCurrentUser() {
        return this.get('vortexUser');
    }

    static setCurrentUser(userData) {
        this.save('vortexUser', userData);
        AppState.currentUser = userData;
    }

    static getFriends(username) {
        const allFriends = this.get('vortexFriends') || {};
        return allFriends[username] || [];
    }

    static saveFriend(username, friendUsername) {
        const allFriends = this.get('vortexFriends') || {};
        if (!allFriends[username]) {
            allFriends[username] = [];
        }
        if (!allFriends[username].includes(friendUsername)) {
            allFriends[username].push(friendUsername);
        }
        this.save('vortexFriends', allFriends);
    }

    static removeFriend(username, friendUsername) {
        const allFriends = this.get('vortexFriends') || {};
        if (allFriends[username]) {
            allFriends[username] = allFriends[username].filter(f => f !== friendUsername);
            this.save('vortexFriends', allFriends);
        }
    }

    static getDMMessages(dmId) {
        const allDMs = this.get('vortexDMs') || {};
        return allDMs[dmId] || [];
    }

    static saveDMMessage(dmId, message) {
        const allDMs = this.get('vortexDMs') || {};
        if (!allDMs[dmId]) {
            allDMs[dmId] = [];
        }
        allDMs[dmId].push(message);
        this.save('vortexDMs', allDMs);
    }

    static getChannelMessages(channelId) {
        const allMessages = this.get('vortexChannelMessages') || {};
        return allMessages[channelId] || [];
    }

    static saveChannelMessage(channelId, message) {
        const allMessages = this.get('vortexChannelMessages') || {};
        if (!allMessages[channelId]) {
            allMessages[channelId] = [];
        }
        allMessages[channelId].push(message);
        this.save('vortexChannelMessages', allMessages);
    }

    static getAllServers() {
        return this.get('vortexServers') || {};
    }

    static saveServer(serverId, serverData) {
        const servers = this.getAllServers();
        servers[serverId] = serverData;
        this.save('vortexServers', servers);
    }

    static getUserServers(username) {
        const allServers = this.getAllServers();
        const userServers = {};
        
        for (const [serverId, server] of Object.entries(allServers)) {
            if (server.members && server.members.includes(username)) {
                userServers[serverId] = server;
            }
        }
        
        return userServers;
    }

    static generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    static generateTag() {
        return Math.floor(1000 + Math.random() * 9000).toString();
    }

    static generateInviteCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = '';
        for (let i = 0; i < 8; i++) {
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return code;
    }
}

// ============================================
// VORTEX BOT - IA INTELLIGENTE
// ============================================
class VortexBot {
    static botUser = {
        username: 'Vortex Bot',
        tag: '0001',
        avatar: 'ü§ñ',
        avatarColor: '#5865f2',
        isBot: true
    };

    static responses = {
        greetings: [
            "Salut ! Je suis Vortex Bot ü§ñ Comment puis-je t'aider aujourd'hui ?",
            "Hey ! Ravi de te parler ! Que puis-je faire pour toi ?",
            "Bonjour ! Je suis l√† pour discuter et r√©pondre √† tes questions !",
            "Coucou ! Vortex Bot √† ton service ! üëã"
        ],
        
        help: [
            "Je peux t'aider avec plein de choses ! Tu peux me demander l'heure, des blagues, des conseils, ou juste discuter ! üí¨",
            "Voici ce que je peux faire : te donner l'heure, raconter des blagues, donner des conseils, parler de technologie, et bien plus ! Essaye de me poser une question !",
            "Je suis l√† pour t'aider ! Pose-moi n'importe quelle question ou dis-moi juste 'blague' pour rire un peu üòÑ"
        ],

        jokes: [
            "Pourquoi les plongeurs plongent-ils toujours en arri√®re ? Parce que sinon ils tombent dans le bateau ! üòÇ",
            "Qu'est-ce qu'un crocodile qui surveille une caserne ? Un Lacoste garde ! üêä",
            "Pourquoi les poissons n'aiment pas jouer au tennis ? Parce qu'ils ont peur du filet ! üéæüêü",
            "Comment appelle-t-on un chat tomb√© dans un pot de peinture le jour de No√´l ? Un chat-peint de No√´l ! üé®üê±",
            "Qu'est-ce qu'un cannibale qui mange son p√®re et sa m√®re ? Un orphelin ! üòÖ"
        ],

        compliments: [
            "Tu es incroyable ! Continue comme √ßa ! ‚ú®",
            "Tu as un super go√ªt en mati√®re de plateformes de chat ! üòé",
            "Je suis s√ªr que tu es une personne g√©niale ! üåü",
            "Ton √©nergie est contagieuse ! Keep going ! üí™"
        ],

        advice: [
            "Mon conseil : prends toujours du temps pour toi, m√™me 5 minutes par jour font la diff√©rence ! üßò",
            "N'oublie pas de boire de l'eau r√©guli√®rement ! L'hydratation c'est important ! üíß",
            "Parfois, la meilleure chose √† faire c'est de faire une pause et respirer profond√©ment. üå¨Ô∏è",
            "Crois en toi ! Tu es capable de plus que tu ne le penses ! üí´"
        ],

        tech: [
            "La technologie √©volue si vite ! Savais-tu que les premiers ordinateurs occupaient des pi√®ces enti√®res ? üñ•Ô∏è",
            "L'IA progresse chaque jour ! Bient√¥t on aura des robots partout... enfin, je suis d√©j√† l√† ! ü§ñ",
            "Le cloud computing a r√©volutionn√© le monde ! Tes donn√©es sont dans les nuages ‚òÅÔ∏è",
            "JavaScript est le langage le plus utilis√© au monde ! Et c'est gr√¢ce √† lui que j'existe ! üíª"
        ],

        unknown: [
            "Hmm, je ne suis pas s√ªr de comprendre. Peux-tu reformuler ? ü§î",
            "Int√©ressant ! Je ne connais pas encore la r√©ponse √† √ßa. Essaye de me poser une autre question !",
            "D√©sol√©, je suis encore en train d'apprendre ! Pose-moi une question sur l'heure, les blagues, ou la tech ! üìö",
            "Je ne suis pas s√ªr... Mais je sais raconter des blagues ! Veux-tu en entendre une ? üòÑ"
        ],

        goodbye: [
            "√Ä plus tard ! C'√©tait cool de discuter avec toi ! üëã",
            "Bye ! N'h√©site pas √† revenir quand tu veux ! üòä",
            "Salut ! Passe une excellente journ√©e ! ‚òÄÔ∏è",
            "Ciao ! √Ä bient√¥t sur Vortex ! üöÄ"
        ]
    };

    static getResponse(message) {
        const msg = message.toLowerCase();

        // Salutations
        if (msg.match(/^(salut|bonjour|hey|coucou|hello|hi)/)) {
            return this.randomChoice(this.responses.greetings);
        }

        // Au revoir
        if (msg.match(/(au revoir|bye|ciao|√† plus|salut|adieu)/)) {
            return this.randomChoice(this.responses.goodbye);
        }

        // Aide
        if (msg.match(/(aide|help|commande|que peux-tu faire|quoi faire)/)) {
            return this.randomChoice(this.responses.help);
        }

        // Blagues
        if (msg.match(/(blague|joke|rigole|dr√¥le|marrant|rire)/)) {
            return this.randomChoice(this.responses.jokes);
        }

        // Heure
        if (msg.match(/(heure|temps|quelle heure|time)/)) {
            const now = new Date();
            return `Il est actuellement ${now.toLocaleTimeString('fr-FR')} ! ‚è∞`;
        }

        // Date
        if (msg.match(/(date|jour|aujourd'hui|quel jour)/)) {
            const now = new Date();
            return `Nous sommes le ${now.toLocaleDateString('fr-FR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            })} ! üìÖ`;
        }

        // Compliments
        if (msg.match(/(merci|cool|g√©nial|super|awesome|top)/)) {
            return this.randomChoice(this.responses.compliments);
        }

        // Conseils
        if (msg.match(/(conseil|advice|tip|astuce|recommandation)/)) {
            return this.randomChoice(this.responses.advice);
        }

        // Technologie
        if (msg.match(/(tech|technologie|ordinateur|code|programmation|ai|ia)/)) {
            return this.randomChoice(this.responses.tech);
        }

        // M√©t√©o simul√©e
        if (msg.match(/(m√©t√©o|meteo|temps qu'il fait|weather)/)) {
            const conditions = ['ensoleill√© ‚òÄÔ∏è', 'nuageux ‚òÅÔ∏è', 'pluvieux üåßÔ∏è', 'partiellement nuageux ‚õÖ'];
            const temp = Math.floor(Math.random() * 20) + 10;
            return `Il fait ${temp}¬∞C et c'est ${this.randomChoice(conditions)} aujourd'hui !`;
        }

        // Comment vas-tu
        if (msg.match(/(comment vas-tu|√ßa va|comment tu vas|how are you)/)) {
            return "Je vais super bien merci ! Je suis toujours pr√™t √† discuter ! Et toi ? üòä";
        }

        // Qui es-tu
        if (msg.match(/(qui es-tu|c'est quoi|ton nom|qui tu es|what are you)/)) {
            return "Je suis Vortex Bot ! Un assistant IA cr√©√© pour t'aider et discuter avec toi sur Vortex ! ü§ñ‚ú®";
        }

        // Calculs simples
        const calcMatch = msg.match(/(\d+)\s*([+\-*/])\s*(\d+)/);
        if (calcMatch) {
            const num1 = parseFloat(calcMatch[1]);
            const op = calcMatch[2];
            const num2 = parseFloat(calcMatch[3]);
            let result;
            
            switch(op) {
                case '+': result = num1 + num2; break;
                case '-': result = num1 - num2; break;
                case '*': result = num1 * num2; break;
                case '/': result = num1 / num2; break;
            }
            
            return `${num1} ${op} ${num2} = ${result} ! üßÆ`;
        }

        // R√©ponse par d√©faut
        return this.randomChoice(this.responses.unknown);
    }

    static randomChoice(array) {
        return array[Math.floor(Math.random() * array.length)];
    }

    static sendAutoReply(dmId, userMessage, delay = 1000) {
        setTimeout(() => {
            const botResponse = this.getResponse(userMessage);
            const message = {
                id: DataManager.generateId(),
                dmId: dmId,
                authorId: 'vortex-bot',
                authorName: this.botUser.username,
                authorAvatar: this.botUser.avatar,
                avatarColor: this.botUser.avatarColor,
                text: botResponse,
                timestamp: new Date().toISOString(),
                isBot: true
            };
            
            DataManager.saveDMMessage(dmId, message);
            
            // Si on est sur la conversation avec le bot, afficher le message
            if (AppState.currentDM && AppState.currentDM.username === 'Vortex Bot') {
                Messages.renderMessage(message, document.getElementById('messagesContainer'));
                const container = document.getElementById('messagesContainer');
                container.scrollTop = container.scrollHeight;
            }
        }, delay);
    }

    static initBot() {
        // Ajouter le bot comme ami automatiquement pour tous les utilisateurs
        const users = DataManager.getAllUsers();
        for (const username in users) {
            const friends = DataManager.getFriends(username);
            if (!friends.includes('Vortex Bot')) {
                DataManager.saveFriend(username, 'Vortex Bot');
            }
        }
        
        // Sauvegarder le bot comme utilisateur
        if (!DataManager.getUserByUsername('Vortex Bot')) {
            DataManager.saveUser('Vortex Bot', this.botUser);
        }
    }
}

// ============================================
// CAPTCHA SYSTEM
// ============================================
class Captcha {
    static init() {
        this.generateCaptcha();
        this.setupListeners();
    }

    static generateCaptcha() {
        const operations = [
            { q: () => {
                const a = Math.floor(Math.random() * 10) + 1;
                const b = Math.floor(Math.random() * 10) + 1;
                return { question: `Combien font ${a} + ${b} ?`, answer: a + b };
            }},
            { q: () => {
                const a = Math.floor(Math.random() * 10) + 5;
                const b = Math.floor(Math.random() * 5) + 1;
                return { question: `Combien font ${a} - ${b} ?`, answer: a - b };
            }},
            { q: () => {
                const a = Math.floor(Math.random() * 10) + 1;
                const b = Math.floor(Math.random() * 5) + 1;
                return { question: `Combien font ${a} √ó ${b} ?`, answer: a * b };
            }}
        ];

        const operation = operations[Math.floor(Math.random() * operations.length)].q();
        AppState.captchaQuestion = operation.question;
        AppState.captchaAnswer = operation.answer;
        
        document.getElementById('captchaQuestion').textContent = operation.question;
    }

    static setupListeners() {
        document.getElementById('verifyCaptchaBtn').addEventListener('click', () => {
            this.verifyCaptcha();
        });

        document.getElementById('captchaInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.verifyCaptcha();
            }
        });
    }

    static verifyCaptcha() {
        const input = document.getElementById('captchaInput');
        const answer = parseInt(input.value);
        const error = document.getElementById('captchaError');

        if (answer === AppState.captchaAnswer) {
            // Captcha correct !
            document.getElementById('captchaContainer').classList.add('hidden');
            document.getElementById('authForm').classList.remove('hidden');
            error.classList.remove('active');
        } else {
            // Mauvaise r√©ponse
            error.classList.add('active');
            input.value = '';
            this.generateCaptcha();
        }
    }
}

// ============================================
// AUTHENTICATION SYSTEM
// ============================================
class Auth {
    static init() {
        this.checkAuth();
        this.setupListeners();
        Captcha.init();
    }

    static checkAuth() {
        const savedUser = DataManager.getCurrentUser();
        if (savedUser) {
            AppState.currentUser = savedUser;
            UI.showApp();
            VortexBot.initBot();
        }
    }

    static setupListeners() {
        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleAuth();
        });

        document.getElementById('authSwitch').addEventListener('click', (e) => {
            e.preventDefault();
            this.toggleMode();
        });
    }

    static toggleMode() {
        AppState.isLoginMode = !AppState.isLoginMode;
        
        const title = document.getElementById('authTitle');
        const subtitle = document.getElementById('authSubtitle');
        const button = document.getElementById('authButton');
        const switchText = document.getElementById('authSwitchText');
        const switchLink = document.getElementById('authSwitch');
        
        if (AppState.isLoginMode) {
            title.textContent = 'Content de te revoir !';
            subtitle.textContent = 'On est heureux de te revoir !';
            button.textContent = 'Connexion';
            switchText.textContent = 'Besoin d\'un compte ?';
            switchLink.textContent = 'S\'inscrire';
        } else {
            title.textContent = 'Cr√©er un compte';
            subtitle.textContent = 'Rejoignez la communaut√© !';
            button.textContent = 'Continuer';
            switchText.textContent = 'Tu as d√©j√† un compte ?';
            switchLink.textContent = 'Se connecter';
        }
        
        // Clear errors
        document.querySelectorAll('.form-error').forEach(el => {
            el.classList.remove('active');
        });
    }

    static handleAuth() {
        const username = document.getElementById('usernameInput').value.trim();
        const email = document.getElementById('emailInput').value.trim();
        const password = document.getElementById('passwordInput').value;
        
        // Clear errors
        document.querySelectorAll('.form-error').forEach(el => {
            el.classList.remove('active');
        });
        
        if (!email || !email.includes('@')) {
            document.getElementById('emailError').classList.add('active');
            return;
        }
        
        if (password.length < 6) {
            document.getElementById('passwordError').classList.add('active');
            return;
        }
        
        if (AppState.isLoginMode) {
            this.login(username, email, password);
        } else {
            if (!username || username.length < 2) {
                document.getElementById('usernameError').textContent = 'Le pseudo doit contenir au moins 2 caract√®res';
                document.getElementById('usernameError').classList.add('active');
                return;
            }
            this.register(username, email, password);
        }
    }

    static login(username, email, password) {
        const users = DataManager.getAllUsers();
        let foundUser = null;
        
        // Chercher par email ou username
        for (const [user, data] of Object.entries(users)) {
            if ((data.email === email || user === username) && data.password === password) {
                foundUser = data;
                break;
            }
        }
        
        if (foundUser) {
            DataManager.setCurrentUser(foundUser);
            UI.showApp();
            VortexBot.initBot();
        } else {
            document.getElementById('emailError').textContent = 'Email/pseudo ou mot de passe incorrect';
            document.getElementById('emailError').classList.add('active');
        }
    }

    static register(username, email, password) {
        const users = DataManager.getAllUsers();
        
        // V√©rifier si le pseudo existe d√©j√†
        if (users[username]) {
            document.getElementById('usernameError').textContent = 'Ce pseudo est d√©j√† pris';
            document.getElementById('usernameError').classList.add('active');
            return;
        }
        
        // V√©rifier si l'email existe d√©j√†
        for (const user of Object.values(users)) {
            if (user.email === email) {
                document.getElementById('emailError').textContent = 'Cette adresse email est d√©j√† utilis√©e';
                document.getElementById('emailError').classList.add('active');
                return;
            }
        }
        
        const newUser = {
            username: username,
            email: email,
            password: password,
            tag: DataManager.generateTag(),
            avatar: username.charAt(0).toUpperCase(),
            avatarColor: '#5865f2',
            bannerColor: '#5865f2',
            createdAt: new Date().toISOString()
        };
        
        DataManager.saveUser(username, newUser);
        DataManager.setCurrentUser(newUser);
        UI.showApp();
        VortexBot.initBot();
    }

    static logout() {
        if (confirm('Es-tu s√ªr de vouloir te d√©connecter ?')) {
            localStorage.removeItem('vortexUser');
            AppState.currentUser = null;
            location.reload();
        }
    }
}

// ============================================
// INITIALIZATION
// ============================================
document.addEventListener('DOMContentLoaded', () => {
    Auth.init();
});
// ============================================
// VORTEX - JAVASCRIPT PARTIE 2
// Serveurs, Channels, Voice & Calls
// ============================================

// ============================================
// SERVER MANAGEMENT
// ============================================
class ServerManager {
    static init() {
        this.loadUserServers();
        this.setupListeners();
    }

    static loadUserServers() {
        if (!AppState.currentUser) return;
        
        AppState.servers = DataManager.getUserServers(AppState.currentUser.username);
        this.renderServerList();
    }

    static setupListeners() {
        // Add server button
        document.getElementById('addServerBtn').addEventListener('click', () => {
            UI.openModal('createServerModal');
        });

        // Create server form
        document.getElementById('createServerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.createServer();
        });

        document.getElementById('cancelCreateServer').addEventListener('click', () => {
            UI.closeModal('createServerModal');
        });

        // Server menu
        document.getElementById('dropdownBtn').addEventListener('click', () => {
            this.toggleServerMenu();
        });

        document.getElementById('inviteBtn').addEventListener('click', () => {
            this.showInviteCode();
        });

        document.getElementById('serverSettingsBtn').addEventListener('click', () => {
            this.showServerSettings();
        });

        document.getElementById('createChannelBtn').addEventListener('click', () => {
            UI.openModal('createChannelModal');
        });

        document.getElementById('leaveServerBtn').addEventListener('click', () => {
            this.leaveServer();
        });

        // Join server
        document.getElementById('joinServerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.joinServer();
        });

        // Welcome buttons
        document.getElementById('createServerWelcomeBtn').addEventListener('click', () => {
            UI.openModal('createServerModal');
        });

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.sidebar-header') && !e.target.closest('.server-menu')) {
                const menu = document.getElementById('serverMenu');
                if (menu.classList.contains('active')) {
                    menu.classList.remove('active');
                    document.querySelector('.dropdown-icon').classList.remove('active');
                }
            }
        });
    }

    static renderServerList() {
        const serverList = document.getElementById('serverList');
        serverList.innerHTML = '';
        
        Object.entries(AppState.servers).forEach(([serverId, server]) => {
            const serverIcon = document.createElement('div');
            serverIcon.className = 'server-icon';
            serverIcon.dataset.serverId = serverId;
            serverIcon.title = server.name;
            serverIcon.innerHTML = `<span>${server.icon || 'üìÅ'}</span>`;
            
            serverIcon.addEventListener('click', () => {
                this.selectServer(serverId);
            });
            
            serverList.appendChild(serverIcon);
        });
    }

    static createServer() {
        const name = document.getElementById('serverNameInput').value.trim();
        const icon = document.getElementById('serverIconInput').value.trim() || 'üéÆ';
        
        if (!name) {
            alert('Entre un nom pour ton serveur !');
            return;
        }
        
        const serverId = DataManager.generateId();
        const inviteCode = DataManager.generateInviteCode();
        
        const newServer = {
            id: serverId,
            name: name,
            icon: icon,
            owner: AppState.currentUser.username,
            members: [AppState.currentUser.username],
            channels: {
                'text': [
                    {
                        id: 'general',
                        name: 'g√©n√©ral',
                        type: 'text',
                        description: 'Canal g√©n√©ral du serveur'
                    }
                ],
                'voice': [
                    {
                        id: 'voice-1',
                        name: 'Vocal G√©n√©ral',
                        type: 'voice',
                        description: 'Salon vocal principal'
                    }
                ]
            },
            inviteCode: inviteCode,
            createdAt: new Date().toISOString()
        };
        
        DataManager.saveServer(serverId, newServer);
        AppState.servers[serverId] = newServer;
        
        this.renderServerList();
        UI.closeModal('createServerModal');
        this.selectServer(serverId);
        
        // Reset form
        document.getElementById('serverNameInput').value = '';
        document.getElementById('serverIconInput').value = '';
    }

    static selectServer(serverId) {
        AppState.currentView = 'server';
        AppState.currentServer = serverId;
        AppState.currentDM = null;
        
        const server = AppState.servers[serverId];
        if (!server) return;
        
        // Update UI
        document.querySelectorAll('.server-icon').forEach(icon => {
            icon.classList.remove('active');
        });
        
        document.querySelector(`[data-server-id="${serverId}"]`)?.classList.add('active');
        
        document.getElementById('sidebarTitle').textContent = server.name;
        document.getElementById('searchBar').style.display = 'block';
        
        // Hide welcome, show channels
        document.getElementById('welcomeScreen').style.display = 'none';
        
        // Load channels
        ChannelManager.loadChannels(server);
        
        // Select first text channel
        if (server.channels.text && server.channels.text.length > 0) {
            ChannelManager.selectChannel(server.channels.text[0].id, 'text');
        }
    }

    static toggleServerMenu() {
        const menu = document.getElementById('serverMenu');
        const icon = document.querySelector('.dropdown-icon');
        
        menu.classList.toggle('active');
        icon.classList.toggle('active');
    }

    static showInviteCode() {
        if (!AppState.currentServer) return;
        
        const server = AppState.servers[AppState.currentServer];
        document.getElementById('inviteCodeDisplay').value = server.inviteCode;
        
        this.toggleServerMenu();
        UI.openModal('inviteModal');
    }

    static showServerSettings() {
        if (!AppState.currentServer) return;
        
        const server = AppState.servers[AppState.currentServer];
        document.getElementById('editServerNameInput').value = server.name;
        document.getElementById('editServerIconInput').value = server.icon;
        
        this.toggleServerMenu();
        UI.openModal('serverSettingsModal');
    }

    static joinServer() {
        const code = document.getElementById('joinCodeInput').value.trim().toUpperCase();
        
        if (!code) {
            alert('Entre un code d\'invitation !');
            return;
        }
        
        const allServers = DataManager.getAllServers();
        let foundServer = null;
        let foundServerId = null;
        
        for (const [serverId, server] of Object.entries(allServers)) {
            if (server.inviteCode === code) {
                foundServer = server;
                foundServerId = serverId;
                break;
            }
        }
        
        if (!foundServer) {
            document.getElementById('joinCodeError').classList.add('active');
            return;
        }
        
        // Check if already member
        if (foundServer.members.includes(AppState.currentUser.username)) {
            alert('Tu es d√©j√† membre de ce serveur !');
            UI.closeModal('joinServerModal');
            this.selectServer(foundServerId);
            return;
        }
        
        // Add user to server
        foundServer.members.push(AppState.currentUser.username);
        DataManager.saveServer(foundServerId, foundServer);
        AppState.servers[foundServerId] = foundServer;
        
        this.renderServerList();
        UI.closeModal('joinServerModal');
        this.selectServer(foundServerId);
        
        document.getElementById('joinCodeInput').value = '';
    }

    static leaveServer() {
        if (!AppState.currentServer) return;
        
        const server = AppState.servers[AppState.currentServer];
        
        if (server.owner === AppState.currentUser.username) {
            alert('Tu ne peux pas quitter un serveur dont tu es propri√©taire !');
            return;
        }
        
        if (confirm(`Es-tu s√ªr de vouloir quitter ${server.name} ?`)) {
            server.members = server.members.filter(m => m !== AppState.currentUser.username);
            DataManager.saveServer(AppState.currentServer, server);
            
            delete AppState.servers[AppState.currentServer];
            AppState.currentServer = null;
            AppState.currentChannel = null;
            
            this.renderServerList();
            this.toggleServerMenu();
            
            // Return to home
            Friends.showHomeView();
        }
    }
}

// ============================================
// CHANNEL MANAGEMENT
// ============================================
class ChannelManager {
    static init() {
        this.setupListeners();
    }

    static setupListeners() {
        // Create channel form
        document.getElementById('createChannelForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.createChannel();
        });

        document.getElementById('cancelCreateChannel').addEventListener('click', () => {
            UI.closeModal('createChannelModal');
        });

        // Channel type selector
        document.querySelectorAll('.channel-type-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.channel-type-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');
            });
        });
    }

    static loadChannels(server) {
        const channelsList = document.getElementById('channelsList');
        channelsList.innerHTML = '';
        
        // Text channels
        if (server.channels.text && server.channels.text.length > 0) {
            const textCategory = document.createElement('div');
            textCategory.className = 'channel-category';
            textCategory.innerHTML = `
                <span>üí¨ SALONS TEXTUELS</span>
                <span class="add-channel-btn" title="Cr√©er un salon">+</span>
            `;
            channelsList.appendChild(textCategory);
            
            textCategory.querySelector('.add-channel-btn').addEventListener('click', () => {
                UI.openModal('createChannelModal');
            });
            
            server.channels.text.forEach(channel => {
                this.createChannelItem(channel, channelsList, 'text');
            });
        }
        
        // Voice channels
        if (server.channels.voice && server.channels.voice.length > 0) {
            const voiceCategory = document.createElement('div');
            voiceCategory.className = 'channel-category';
            voiceCategory.innerHTML = `
                <span>üîä SALONS VOCAUX</span>
                <span class="add-channel-btn" title="Cr√©er un salon">+</span>
            `;
            channelsList.appendChild(voiceCategory);
            
            voiceCategory.querySelector('.add-channel-btn').addEventListener('click', () => {
                document.querySelector('[data-type="voice"]').click();
                UI.openModal('createChannelModal');
            });
            
            server.channels.voice.forEach(channel => {
                this.createChannelItem(channel, channelsList, 'voice');
            });
        }
    }

    static createChannelItem(channel, container, type) {
        const channelItem = document.createElement('div');
        channelItem.className = 'channel-item';
        channelItem.dataset.channelId = channel.id;
        channelItem.dataset.channelType = type;
        
        const icon = type === 'text' ? '#' : 'üîä';
        
        channelItem.innerHTML = `
            <span class="channel-icon">${icon}</span>
            <span class="channel-label">${channel.name}</span>
            <span class="voice-indicator"></span>
        `;
        
        channelItem.addEventListener('click', () => {
            if (type === 'voice') {
                VoiceManager.joinVoiceChannel(channel.id, channel.name);
            } else {
                this.selectChannel(channel.id, type);
            }
        });
        
        container.appendChild(channelItem);
    }

    static selectChannel(channelId, type) {
        AppState.currentChannel = channelId;
        AppState.currentView = 'channel';
        
        const server = AppState.servers[AppState.currentServer];
        const channel = type === 'text' 
            ? server.channels.text.find(c => c.id === channelId)
            : server.channels.voice.find(c => c.id === channelId);
        
        if (!channel) return;
        
        // Update UI
        document.querySelectorAll('.channel-item').forEach(item => {
            item.classList.remove('active');
        });
        
        document.querySelector(`[data-channel-id="${channelId}"]`)?.classList.add('active');
        
        // Update header
        document.getElementById('chatIcon').textContent = type === 'text' ? '#' : 'üîä';
        document.getElementById('chatName').textContent = channel.name;
        document.getElementById('chatDescription').textContent = channel.description || '';
        
        // Show chat elements
        document.getElementById('chatHeader').classList.add('active');
        document.getElementById('messagesContainer').classList.add('active');
        document.getElementById('messageInputArea').classList.add('active');
        
        // Load messages
        if (type === 'text') {
            Messages.loadChannelMessages(channelId);
        }
        
        // Load members
        MemberManager.loadMembers(server.members);
    }

    static createChannel() {
        if (!AppState.currentServer) return;
        
        const name = document.getElementById('channelNameInput').value.trim();
        const type = document.querySelector('.channel-type-option.active').dataset.type;
        
        if (!name) {
            alert('Entre un nom pour le salon !');
            return;
        }
        
        const channelId = DataManager.generateId();
        const server = AppState.servers[AppState.currentServer];
        
        const newChannel = {
            id: channelId,
            name: name,
            type: type,
            description: `Salon ${type === 'text' ? 'textuel' : 'vocal'}`
        };
        
        if (type === 'text') {
            server.channels.text.push(newChannel);
        } else {
            server.channels.voice.push(newChannel);
        }
        
        DataManager.saveServer(AppState.currentServer, server);
        this.loadChannels(server);
        
        UI.closeModal('createChannelModal');
        document.getElementById('channelNameInput').value = '';
    }
}

// ============================================
// VOICE MANAGER
// ============================================
class VoiceManager {
    static init() {
        this.setupListeners();
    }

    static setupListeners() {
        // Voice controls in panel
        document.getElementById('micToggle').addEventListener('click', () => {
            this.toggleMic();
        });

        document.getElementById('audioToggle').addEventListener('click', () => {
            this.toggleAudio();
        });

        document.getElementById('voiceDisconnect').addEventListener('click', () => {
            this.disconnectVoice();
        });

        // User controls
        document.getElementById('userMicBtn').addEventListener('click', () => {
            this.toggleMic();
        });

        document.getElementById('userAudioBtn').addEventListener('click', () => {
            this.toggleAudio();
        });
    }

    static joinVoiceChannel(channelId, channelName) {
        if (AppState.voiceState.connected) {
            // Already in voice, disconnect first
            this.disconnectVoice();
        }
        
        AppState.voiceState = {
            connected: true,
            channelId: channelId,
            channelName: channelName,
            micMuted: false,
            audioMuted: false
        };
        
        // Show voice panel
        document.getElementById('voicePanel').classList.add('active');
        document.getElementById('voiceChannelName').textContent = channelName;
        
        // Update channel indicator
        const channelItem = document.querySelector(`[data-channel-id="${channelId}"]`);
        if (channelItem) {
            channelItem.querySelector('.voice-indicator').classList.add('active');
        }
        
        // Simulate voice connection
        this.simulateVoiceConnection();
        
        // Show notification
        this.showNotification(`‚úÖ Connect√© √† ${channelName}`, 'success');
    }

    static disconnectVoice() {
        if (!AppState.voiceState.connected) return;
        
        const channelId = AppState.voiceState.channelId;
        const channelName = AppState.voiceState.channelName;
        
        // Hide voice panel
        document.getElementById('voicePanel').classList.remove('active');
        
        // Update channel indicator
        const channelItem = document.querySelector(`[data-channel-id="${channelId}"]`);
        if (channelItem) {
            channelItem.querySelector('.voice-indicator').classList.remove('active');
        }
        
        AppState.voiceState = {
            connected: false,
            channelId: null,
            channelName: '',
            micMuted: false,
            audioMuted: false
        };
        
        // Reset buttons
        document.getElementById('micToggle').classList.remove('muted');
        document.getElementById('audioToggle').classList.remove('muted');
        document.getElementById('userMicBtn').classList.remove('muted');
        document.getElementById('userAudioBtn').classList.remove('muted');
        
        this.showNotification(`D√©connect√© de ${channelName}`, 'info');
    }

    static toggleMic() {
        if (!AppState.voiceState.connected) return;
        
        AppState.voiceState.micMuted = !AppState.voiceState.micMuted;
        
        const micBtn = document.getElementById('micToggle');
        const userMicBtn = document.getElementById('userMicBtn');
        
        if (AppState.voiceState.micMuted) {
            micBtn.classList.add('muted');
            userMicBtn.classList.add('muted');
            micBtn.querySelector('.voice-icon').textContent = 'üé§';
            userMicBtn.querySelector('span').textContent = 'üîá';
            this.showNotification('üîá Micro coup√©', 'warning');
        } else {
            micBtn.classList.remove('muted');
            userMicBtn.classList.remove('muted');
            micBtn.querySelector('.voice-icon').textContent = 'üé§';
            userMicBtn.querySelector('span').textContent = 'üé§';
            this.showNotification('üé§ Micro activ√©', 'success');
        }
    }

    static toggleAudio() {
        if (!AppState.voiceState.connected) return;
        
        AppState.voiceState.audioMuted = !AppState.voiceState.audioMuted;
        
        const audioBtn = document.getElementById('audioToggle');
        const userAudioBtn = document.getElementById('userAudioBtn');
        
        if (AppState.voiceState.audioMuted) {
            audioBtn.classList.add('muted');
            userAudioBtn.classList.add('muted');
            audioBtn.querySelector('.voice-icon').textContent = 'üîá';
            userAudioBtn.querySelector('span').textContent = 'üîá';
            this.showNotification('üîá Audio coup√©', 'warning');
        } else {
            audioBtn.classList.remove('muted');
            userAudioBtn.classList.remove('muted');
            audioBtn.querySelector('.voice-icon').textContent = 'üéß';
            userAudioBtn.querySelector('span').textContent = 'üéß';
            this.showNotification('üéß Audio activ√©', 'success');
        }
    }

    static simulateVoiceConnection() {
        // Simulate voice activity indicator
        setInterval(() => {
            if (AppState.voiceState.connected && !AppState.voiceState.micMuted) {
                // Random voice activity simulation
                if (Math.random() > 0.7) {
                    const indicator = document.querySelector(`[data-channel-id="${AppState.voiceState.channelId}"] .voice-indicator`);
                    if (indicator) {
                        indicator.style.animation = 'voicePulse 0.5s';
                        setTimeout(() => {
                            indicator.style.animation = 'voicePulse 2s infinite';
                        }, 500);
                    }
                }
            }
        }, 2000);
    }

    static showNotification(message, type) {
        // Create toast notification
        const toast = document.createElement('div');
        toast.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: ${type === 'success' ? '#23a559' : type === 'warning' ? '#f0b232' : '#5865f2'};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 10000;
            animation: slideInUp 0.3s ease;
        `;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideOutDown 0.3s ease';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
}

// ============================================
// CALL MANAGER
// ============================================
class CallManager {
    static init() {
        this.setupListeners();
    }

    static setupListeners() {
        document.getElementById('startCallBtn').addEventListener('click', () => {
            this.startCall('voice');
        });
    }

    static startCall(type) {
        if (!AppState.currentDM && !AppState.currentChannel) return;
        
        const targetName = AppState.currentDM 
            ? AppState.currentDM.username 
            : document.getElementById('chatName').textContent;
        
        if (confirm(`D√©marrer un appel ${type === 'video' ? 'vid√©o' : 'vocal'} avec ${targetName} ?`)) {
            AppState.callState = {
                active: true,
                type: type,
                with: targetName
            };
            
            this.showCallInterface();
            VoiceManager.showNotification(`üìû Appel ${type === 'video' ? 'vid√©o' : 'vocal'} en cours...`, 'success');
        }
    }

    static showCallInterface() {
        // Create call overlay
        const callOverlay = document.createElement('div');
        callOverlay.id = 'callOverlay';
        callOverlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        `;
        
        callOverlay.innerHTML = `
            <div style="font-size: 48px;">${AppState.callState.type === 'video' ? 'üìπ' : 'üìû'}</div>
            <div style="font-size: 24px; font-weight: 600;">Appel avec ${AppState.callState.with}</div>
            <div style="font-size: 18px; color: #949ba4;">En communication...</div>
            <div style="display: flex; gap: 20px; margin-top: 40px;">
                <button onclick="VoiceManager.toggleMic()" style="width: 60px; height: 60px; border-radius: 50%; background: #23a559; border: none; font-size: 28px; cursor: pointer;">üé§</button>
                <button onclick="CallManager.endCall()" style="width: 60px; height: 60px; border-radius: 50%; background: #f23f43; border: none; font-size: 28px; cursor: pointer;">üìû</button>
                ${AppState.callState.type === 'video' ? '<button style="width: 60px; height: 60px; border-radius: 50%; background: #5865f2; border: none; font-size: 28px; cursor: pointer;">üìπ</button>' : ''}
            </div>
        `;
        
        document.body.appendChild(callOverlay);
    }

    static endCall() {
        AppState.callState = {
            active: false,
            type: null,
            with: null
        };
        
        const callOverlay = document.getElementById('callOverlay');
        if (callOverlay) {
            callOverlay.remove();
        }
        
        VoiceManager.showNotification('üìû Appel termin√©', 'info');
    }
}

// ============================================
// INITIALIZATION
// ============================================
document.addEventListener('DOMContentLoaded', () => {
    ServerManager.init();
    ChannelManager.init();
    VoiceManager.init();
    CallManager.init();
});
// ============================================
// VORTEX - JAVASCRIPT PARTIE 3 (FINAL)
// Messages, Amis, UI, Settings
// ============================================

// ============================================
// MESSAGES
// ============================================
class Messages {
    static init() {
        this.setupListeners();
    }

    static setupListeners() {
        const input = document.getElementById('messageInput');
        
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                this.sendMessage();
            }
        });
    }

    static loadChannelMessages(channelId) {
        const messages = DataManager.getChannelMessages(channelId);
        const container = document.getElementById('messagesContainer');
        container.innerHTML = '';
        
        if (messages.length === 0) {
            const welcome = document.createElement('div');
            welcome.className = 'welcome-channel';
            const channel = AppState.servers[AppState.currentServer]
                .channels.text.find(c => c.id === channelId);
            welcome.innerHTML = `
                <div class="welcome-icon">#</div>
                <div class="welcome-title">Bienvenue dans #${channel.name}</div>
                <div class="welcome-text">${channel.description}</div>
            `;
            container.appendChild(welcome);
        } else {
            messages.forEach(msg => this.renderMessage(msg, container));
            container.scrollTop = container.scrollHeight;
        }
    }

    static loadDM(friend) {
        const dmId = this.getDMId(AppState.currentUser.username, friend.username);
        const messages = DataManager.getDMMessages(dmId);
        const container = document.getElementById('messagesContainer');
        container.innerHTML = '';
        
        if (messages.length === 0) {
            const welcome = document.createElement('div');
            welcome.className = 'welcome-channel';
            welcome.innerHTML = `
                <div class="welcome-icon" style="background: ${friend.avatarColor || '#5865f2'}; border-radius: 50%; width: 80px; height: 80px; font-size: 32px;">${friend.avatar}</div>
                <div class="welcome-title">${friend.username}</div>
                <div class="welcome-text">C'est le d√©but de votre conversation !</div>
            `;
            container.appendChild(welcome);
        } else {
            messages.forEach(msg => this.renderMessage(msg, container));
            container.scrollTop = container.scrollHeight;
        }
    }

    static renderMessage(msg, container) {
        const messageGroup = document.createElement('div');
        messageGroup.className = 'message-group';
        
        const time = new Date(msg.timestamp).toLocaleTimeString('fr-FR', {
            hour: '2-digit',
            minute: '2-digit'
        });
        
        const avatarStyle = msg.avatarColor 
            ? `background: ${msg.avatarColor}` 
            : 'background: linear-gradient(135deg, #5865f2, #57f287)';
        
        messageGroup.innerHTML = `
            <div class="message-avatar" style="${avatarStyle}">${msg.authorAvatar}</div>
            <div class="message-content">
                <div class="message-header">
                    <span class="message-author">${msg.authorName}${msg.isBot ? ' ü§ñ' : ''}</span>
                    <span class="message-timestamp">${time}</span>
                </div>
                <div class="message-text">${this.escapeHtml(msg.text)}</div>
            </div>
        `;
        
        container.appendChild(messageGroup);
    }

    static sendMessage() {
        const input = document.getElementById('messageInput');
        const text = input.value.trim();
        
        if (!text) return;
        
        const message = {
            id: DataManager.generateId(),
            authorId: AppState.currentUser.username,
            authorName: AppState.currentUser.username,
            authorAvatar: AppState.currentUser.avatar,
            avatarColor: AppState.currentUser.avatarColor,
            text: text,
            timestamp: new Date().toISOString()
        };
        
        const container = document.getElementById('messagesContainer');
        
        // Remove welcome if present
        const welcome = container.querySelector('.welcome-channel');
        if (welcome) welcome.remove();
        
        if (AppState.currentView === 'dm' && AppState.currentDM) {
            // DM message
            const dmId = this.getDMId(AppState.currentUser.username, AppState.currentDM.username);
            message.dmId = dmId;
            DataManager.saveDMMessage(dmId, message);
            this.renderMessage(message, container);
            
            // If messaging Vortex Bot, get auto-reply
            if (AppState.currentDM.username === 'Vortex Bot') {
                VortexBot.sendAutoReply(dmId, text, 1500);
            }
        } else if (AppState.currentView === 'channel' && AppState.currentChannel) {
            // Channel message
            message.channelId = AppState.currentChannel;
            DataManager.saveChannelMessage(AppState.currentChannel, message);
            this.renderMessage(message, container);
        }
        
        input.value = '';
        container.scrollTop = container.scrollHeight;
    }

    static getDMId(user1, user2) {
        return [user1, user2].sort().join('_');
    }

    static escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}

// ============================================
// FRIENDS
// ============================================
class Friends {
    static init() {
        this.setupListeners();
        this.loadFriends();
    }

    static setupListeners() {
        // DM button
        document.getElementById('dmButton').addEventListener('click', () => {
            this.showHomeView();
        });

        // Add friend buttons
        document.getElementById('addFriendWelcomeBtn').addEventListener('click', () => {
            UI.openModal('addFriendModal');
        });

        // Add friend form
        document.getElementById('addFriendForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addFriend();
        });

        document.getElementById('cancelAddFriend').addEventListener('click', () => {
            UI.closeModal('addFriendModal');
        });
    }

    static loadFriends() {
        if (!AppState.currentUser) return;
        
        AppState.friends = DataManager.getFriends(AppState.currentUser.username);
        this.renderDMList();
    }

    static renderDMList() {
        const container = document.getElementById('channelsList');
        
        // Keep only section header
        container.innerHTML = '<div class="dm-section"><div class="section-header"><span>MESSAGES PRIV√âS</span></div></div>';
        
        const users = DataManager.getAllUsers();
        
        AppState.friends.forEach(friendUsername => {
            const friend = users[friendUsername];
            if (!friend) return;
            
            const dmItem = document.createElement('div');
            dmItem.className = 'dm-item';
            dmItem.dataset.friendUsername = friendUsername;
            
            const avatarStyle = friend.avatarColor 
                ? `background: ${friend.avatarColor}` 
                : 'background: linear-gradient(135deg, #5865f2, #57f287)';
            
            dmItem.innerHTML = `
                <div class="dm-avatar" style="${avatarStyle}">${friend.avatar}</div>
                <div class="dm-info">
                    <div class="dm-name">${friend.username}${friend.isBot ? ' ü§ñ' : ''}</div>
                    <div class="dm-status">En ligne</div>
                </div>
            `;
            
            dmItem.addEventListener('click', () => {
                this.openDM(friend);
            });
            
            // Add context menu for friend removal
            dmItem.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                if (!friend.isBot) {
                    this.showFriendContextMenu(e, friend);
                }
            });
            
            container.appendChild(dmItem);
        });
    }

    static addFriend() {
        const friendUsername = document.getElementById('friendUsernameInput').value.trim();
        const errorEl = document.getElementById('friendError');
        const successEl = document.getElementById('friendSuccess');
        
        errorEl.classList.remove('active');
        successEl.classList.remove('active');
        
        if (!friendUsername) {
            errorEl.textContent = 'Entre un pseudo';
            errorEl.classList.add('active');
            return;
        }
        
        if (friendUsername === AppState.currentUser.username) {
            errorEl.textContent = 'Tu ne peux pas t\'ajouter toi-m√™me !';
            errorEl.classList.add('active');
            return;
        }
        
        const friend = DataManager.getUserByUsername(friendUsername);
        
        if (!friend) {
            errorEl.textContent = 'Aucun utilisateur trouv√© avec ce pseudo';
            errorEl.classList.add('active');
            return;
        }
        
        if (AppState.friends.includes(friendUsername)) {
            errorEl.textContent = 'Tu es d√©j√† ami avec cet utilisateur !';
            errorEl.classList.add('active');
            return;
        }
        
        // Add friend
        DataManager.saveFriend(AppState.currentUser.username, friendUsername);
        DataManager.saveFriend(friendUsername, AppState.currentUser.username);
        
        this.loadFriends();
        
        successEl.classList.add('active');
        document.getElementById('friendUsernameInput').value = '';
        
        setTimeout(() => {
            UI.closeModal('addFriendModal');
        }, 1500);
    }

    static showFriendContextMenu(event, friend) {
        // Remove existing menu
        const existingMenu = document.getElementById('friendContextMenu');
        if (existingMenu) existingMenu.remove();
        
        const menu = document.createElement('div');
        menu.id = 'friendContextMenu';
        menu.style.cssText = `
            position: fixed;
            left: ${event.pageX}px;
            top: ${event.pageY}px;
            background: var(--bg-darker);
            border: 1px solid var(--bg-lighter);
            border-radius: 4px;
            padding: 6px;
            z-index: 10000;
            min-width: 180px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.24);
        `;
        
        menu.innerHTML = `
            <div class="context-menu-item" style="padding: 8px 10px; border-radius: 2px; cursor: pointer; font-size: 14px; color: var(--error);" onmouseover="this.style.background='var(--error)'; this.style.color='white'" onmouseout="this.style.background=''; this.style.color='var(--error)'">
                <span>‚ùå</span>
                <span>Supprimer l'ami</span>
            </div>
        `;
        
        menu.querySelector('.context-menu-item').addEventListener('click', () => {
            this.removeFriend(friend.username);
            menu.remove();
        });
        
        document.body.appendChild(menu);
        
        // Close on click outside
        setTimeout(() => {
            document.addEventListener('click', () => menu.remove(), { once: true });
        }, 100);
    }

    static removeFriend(friendUsername) {
        if (confirm(`Es-tu s√ªr de vouloir supprimer ${friendUsername} de tes amis ?`)) {
            DataManager.removeFriend(AppState.currentUser.username, friendUsername);
            DataManager.removeFriend(friendUsername, AppState.currentUser.username);
            
            this.loadFriends();
            
            // If currently in DM with this friend, go back home
            if (AppState.currentDM && AppState.currentDM.username === friendUsername) {
                this.showHomeView();
            }
            
            VoiceManager.showNotification(`${friendUsername} a √©t√© supprim√© de tes amis`, 'info');
        }
    }

    static openDM(friend) {
        AppState.currentView = 'dm';
        AppState.currentDM = friend;
        AppState.currentServer = null;
        AppState.currentChannel = null;
        
        // Update UI
        document.querySelectorAll('.dm-item').forEach(item => item.classList.remove('active'));
        document.querySelector(`[data-friend-username="${friend.username}"]`)?.classList.add('active');
        
        document.querySelectorAll('.server-icon').forEach(icon => icon.classList.remove('active'));
        document.getElementById('dmButton').classList.add('active');
        
        // Update header
        document.getElementById('chatIcon').textContent = '@';
        document.getElementById('chatName').textContent = friend.username;
        document.getElementById('chatDescription').textContent = friend.isBot ? 'Bot intelligent' : 'Message priv√©';
        
        // Show chat
        document.getElementById('welcomeScreen').style.display = 'none';
        document.getElementById('chatHeader').classList.add('active');
        document.getElementById('messagesContainer').classList.add('active');
        document.getElementById('messageInputArea').classList.add('active');
        
        // Load messages
        Messages.loadDM(friend);
    }

    static showHomeView() {
        AppState.currentView = 'home';
        AppState.currentDM = null;
        AppState.currentServer = null;
        AppState.currentChannel = null;
        
        // Update UI
        document.querySelectorAll('.server-icon, .dm-item, .channel-item').forEach(item => {
            item.classList.remove('active');
        });
        document.getElementById('dmButton').classList.add('active');
        
        document.getElementById('sidebarTitle').textContent = 'Amis';
        document.getElementById('searchBar').style.display = 'block';
        
        // Show welcome screen
        document.getElementById('welcomeScreen').style.display = 'flex';
        document.getElementById('chatHeader').classList.remove('active');
        document.getElementById('messagesContainer').classList.remove('active');
        document.getElementById('messageInputArea').classList.remove('active');
        
        // Update welcome
        document.getElementById('welcomeUsername').textContent = `Salut ${AppState.currentUser.username} ! üëã`;
        
        this.renderDMList();
    }
}

// ============================================
// MEMBERS
// ============================================
class MemberManager {
    static init() {
        this.setupListeners();
    }

    static setupListeners() {
        document.getElementById('toggleMembersBtn').addEventListener('click', () => {
            this.toggleSidebar();
        });
    }

    static loadMembers(memberUsernames) {
        const container = document.getElementById('membersList');
        container.innerHTML = '';
        
        const users = DataManager.getAllUsers();
        const members = memberUsernames.map(username => users[username]).filter(Boolean);
        
        // Owner category
        const server = AppState.servers[AppState.currentServer];
        const owner = members.find(m => m.username === server.owner);
        
        if (owner) {
            const ownerCategory = document.createElement('div');
            ownerCategory.className = 'member-category';
            ownerCategory.textContent = 'üëë PROPRI√âTAIRE ‚Äî 1';
            container.appendChild(ownerCategory);
            
            this.createMemberItem(owner, container);
        }
        
        // Members category
        const otherMembers = members.filter(m => m.username !== server.owner);
        
        if (otherMembers.length > 0) {
            const membersCategory = document.createElement('div');
            membersCategory.className = 'member-category';
            membersCategory.textContent = `üë• MEMBRES ‚Äî ${otherMembers.length}`;
            container.appendChild(membersCategory);
            
            otherMembers.forEach(member => this.createMemberItem(member, container));
        }
        
        document.getElementById('membersCount').textContent = members.length;
    }

    static createMemberItem(member, container) {
        const memberItem = document.createElement('div');
        memberItem.className = 'member-item';
        
        const avatarStyle = member.avatarColor 
            ? `background: ${member.avatarColor}` 
            : 'background: linear-gradient(135deg, #5865f2, #57f287)';
        
        memberItem.innerHTML = `
            <div class="member-avatar" style="${avatarStyle}">${member.avatar}</div>
            <div class="member-name">${member.username}${member.isBot ? ' ü§ñ' : ''}</div>
        `;
        
        container.appendChild(memberItem);
    }

    static toggleSidebar() {
        const sidebar = document.getElementById('membersSidebar');
        AppState.membersSidebarOpen = !AppState.membersSidebarOpen;
        
        if (AppState.membersSidebarOpen) {
            sidebar.classList.add('active');
        } else {
            sidebar.classList.remove('active');
        }
    }
}

// ============================================
// USER INTERFACE
// ============================================
class UI {
    static init() {
        this.setupListeners();
    }

    static setupListeners() {
        // Settings modal
        document.getElementById('userSettingsBtn').addEventListener('click', () => {
            this.openUserSettings();
        });

        document.getElementById('closeUserSettings').addEventListener('click', () => {
            this.closeModal('userSettingsModal');
        });

        // Modal nav tabs
        document.querySelectorAll('.modal-nav-item').forEach(item => {
            if (item.id !== 'logoutBtn') {
                item.addEventListener('click', () => {
                    const tab = item.dataset.tab;
                    this.switchSettingsTab(tab);
                });
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            Auth.logout();
        });

        // Edit username
        document.getElementById('editUsernameBtn').addEventListener('click', () => {
            this.openModal('editUsernameModal');
        });

        document.getElementById('editUsernameForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.updateUsername();
        });

        document.getElementById('cancelEditUsername').addEventListener('click', () => {
            this.closeModal('editUsernameModal');
        });

        // Edit password
        document.getElementById('editPasswordBtn').addEventListener('click', () => {
            this.openModal('editPasswordModal');
        });

        document.getElementById('editPasswordForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.updatePassword();
        });

        document.getElementById('cancelEditPassword').addEventListener('click', () => {
            this.closeModal('editPasswordModal');
        });

        // Avatar color picker
        document.querySelectorAll('#avatarColorPicker .color-option').forEach(option => {
            option.addEventListener('click', () => {
                this.updateAvatarColor(option.dataset.color);
            });
        });

        // Banner color picker
        document.querySelectorAll('#bannerColorPicker .color-option').forEach(option => {
            option.addEventListener('click', () => {
                this.updateBannerColor(option.dataset.color);
            });
        });

        // Copy invite code
        document.getElementById('copyInviteBtn').addEventListener('click', () => {
            this.copyInviteCode();
        });

        document.getElementById('closeInviteModal').addEventListener('click', () => {
            this.closeModal('inviteModal');
        });

        // Server settings
        document.getElementById('serverSettingsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.updateServerSettings();
        });

        document.getElementById('cancelServerSettings').addEventListener('click', () => {
            this.closeModal('serverSettingsModal');
        });

        document.getElementById('cancelJoinServer').addEventListener('click', () => {
            this.closeModal('joinServerModal');
        });

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    this.closeModal(modal.id);
                }
            });
        });
    }

    static showApp() {
        document.getElementById('authContainer').style.display = 'none';
        document.getElementById('appContainer').classList.add('active');
        
        // Update user info
        const user = AppState.currentUser;
        document.getElementById('userName').textContent = user.username;
        document.getElementById('userTag').textContent = `#${user.tag}`;
        document.getElementById('userAvatar').textContent = user.avatar;
        document.getElementById('userAvatar').style.background = user.avatarColor || '#5865f2';
        document.getElementById('welcomeUsername').textContent = `Salut ${user.username} ! üëã`;
        
        // Load friends
        Friends.loadFriends();
        
        // Show home view
        Friends.showHomeView();
    }

    static openUserSettings() {
        this.openModal('userSettingsModal');
        this.updateSettingsDisplay();
    }

    static updateSettingsDisplay() {
        const user = AppState.currentUser;
        
        // Account tab
        document.getElementById('displayUsername').textContent = user.username;
        document.getElementById('displayEmail').textContent = user.email;
        
        // Profile tab
        document.getElementById('profileUsername').textContent = user.username;
        document.getElementById('profileTag').textContent = `#${user.tag}`;
        document.getElementById('profileAvatar').textContent = user.avatar;
        document.getElementById('profileAvatar').style.background = user.avatarColor || '#5865f2';
        document.getElementById('profileBanner').style.background = user.bannerColor || '#5865f2';
    }

    static switchSettingsTab(tab) {
        // Update nav
        document.querySelectorAll('.modal-nav-item').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tab}"]`)?.classList.add('active');
        
        // Update content
        document.querySelectorAll('.settings-tab').forEach(t => {
            t.classList.remove('active');
        });
        document.getElementById(`${tab}Tab`)?.classList.add('active');
    }

    static updateUsername() {
        const newUsername = document.getElementById('newUsernameInput').value.trim();
        const password = document.getElementById('confirmPasswordUsername').value;
        const error = document.getElementById('usernamePasswordError');
        
        error.classList.remove('active');
        
        if (password !== AppState.currentUser.password) {
            error.classList.add('active');
            return;
        }
        
        if (!newUsername || newUsername.length < 2) {
            alert('Le pseudo doit contenir au moins 2 caract√®res');
            return;
        }
        
        // Check if username exists
        if (DataManager.getUserByUsername(newUsername) && newUsername !== AppState.currentUser.username) {
            alert('Ce pseudo est d√©j√† pris');
            return;
        }
        
        const oldUsername = AppState.currentUser.username;
        
        // Update user
        AppState.currentUser.username = newUsername;
        AppState.currentUser.avatar = newUsername.charAt(0).toUpperCase();
        
        // Save
        const users = DataManager.getAllUsers();
        delete users[oldUsername];
        users[newUsername] = AppState.currentUser;
        DataManager.save('vortexUsers', users);
        DataManager.setCurrentUser(AppState.currentUser);
        
        // Update UI
        document.getElementById('userName').textContent = newUsername;
        document.getElementById('userAvatar').textContent = newUsername.charAt(0).toUpperCase();
        this.updateSettingsDisplay();
        this.closeModal('editUsernameModal');
        
        VoiceManager.showNotification('‚úÖ Pseudo mis √† jour !', 'success');
    }

    static updatePassword() {
        const current = document.getElementById('currentPasswordInput').value;
        const newPass = document.getElementById('newPasswordInput').value;
        const confirm = document.getElementById('confirmPasswordInput').value;
        
        document.querySelectorAll('#editPasswordModal .form-error').forEach(e => e.classList.remove('active'));
        
        if (current !== AppState.currentUser.password) {
            document.getElementById('currentPasswordError').classList.add('active');
            return;
        }
        
        if (newPass.length < 6) {
            alert('Le mot de passe doit contenir au moins 6 caract√®res');
            return;
        }
        
        if (newPass !== confirm) {
            document.getElementById('confirmPasswordError').classList.add('active');
            return;
        }
        
        AppState.currentUser.password = newPass;
        DataManager.saveUser(AppState.currentUser.username, AppState.currentUser);
        DataManager.setCurrentUser(AppState.currentUser);
        
        this.closeModal('editPasswordModal');
        VoiceManager.showNotification('‚úÖ Mot de passe mis √† jour !', 'success');
    }

    static updateAvatarColor(color) {
        AppState.currentUser.avatarColor = color;
        DataManager.saveUser(AppState.currentUser.username, AppState.currentUser);
        DataManager.setCurrentUser(AppState.currentUser);
        
        document.getElementById('profileAvatar').style.background = color;
        document.getElementById('userAvatar').style.background = color;
        
        document.querySelectorAll('#avatarColorPicker .color-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        event.target.classList.add('selected');
    }

    static updateBannerColor(color) {
        AppState.currentUser.bannerColor = color;
        DataManager.saveUser(AppState.currentUser.username, AppState.currentUser);
        DataManager.setCurrentUser(AppState.currentUser);
        
        document.getElementById('profileBanner').style.background = color;
        
        document.querySelectorAll('#bannerColorPicker .color-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        event.target.classList.add('selected');
    }

    static copyInviteCode() {
        const input = document.getElementById('inviteCodeDisplay');
        input.select();
        document.execCommand('copy');
        
        const btn = document.getElementById('copyInviteBtn');
        btn.textContent = '‚úì Copi√© !';
        btn.style.background = '#23a559';
        
        setTimeout(() => {
            btn.textContent = 'Copier';
            btn.style.background = '';
        }, 2000);
    }

    static updateServerSettings() {
        if (!AppState.currentServer) return;
        
        const name = document.getElementById('editServerNameInput').value.trim();
        const icon = document.getElementById('editServerIconInput').value.trim();
        
        const server = AppState.servers[AppState.currentServer];
        server.name = name;
        server.icon = icon;
        
        DataManager.saveServer(AppState.currentServer, server);
        
        document.getElementById('sidebarTitle').textContent = name;
        document.querySelector(`[data-server-id="${AppState.currentServer}"] span`).textContent = icon;
        
        this.closeModal('serverSettingsModal');
        VoiceManager.showNotification('‚úÖ Serveur mis √† jour !', 'success');
    }

    static openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
            
            // Clear form errors
            modal.querySelectorAll('.form-error').forEach(e => e.classList.remove('active'));
        }
    }

    static closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
            
            // Reset forms
            modal.querySelectorAll('form').forEach(form => form.reset());
            modal.querySelectorAll('.form-error, .form-success').forEach(e => e.classList.remove('active'));
        }
    }
}

// ============================================
// INITIALIZATION FINALE
// ============================================
document.addEventListener('DOMContentLoaded', () => {
    Messages.init();
    Friends.init();
    MemberManager.init();
    UI.init();
});
    </script>
</body>
</html>
